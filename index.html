<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PF2 Character Builder</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
<div id="app">
</div>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<script>
const stats = ["Strength", "Dexterity", "Constitution", "Intelligence", "Wisdom", "Charisma"];

const Untrained = 0;
const Trained = 2;
const Expert = 4;
const Master = 6;
const Legendary = 8;

const ancestries = {
    "": {
        hp: 0,
        size: "",
        speed: 0,
        scores: {},
        free: 0,
        languages: [],
        language_options: [],
        traits: [],
        darkvision: false
    },
    "Dwarf": {
        hp: 10,
        size: "Medium",
        speed: 20,
        scores: {
            "Constitution": +2,
            "Wisdom": +2,
            "Charisma": -2
        },
        free: 1,
        languages: ["Common", "Dwarven"],
        language_options: ["Gnomish", "Goblin", "Jotun", "Orcish", "Terran", "Undercommon"],
        traits: ["Dwarf", "Hunamoid"],
        darkvision: true
    }
};

const backgrounds = {
    "": {
        boost1: [],
        boost2: [],
        skill_feat: "",
        skill1: "",
        skill2: []
    },
    "Nomad": {
        boost1: ["Constitution", "Wisdom"],
        boost2: stats,
        skill_feat: "Assurance (Survival)",
        skill1: "Survival",
        skill2: ["Arctic Lore", "Desert Lore", "Forest Lore", "Grassland Lore", "Mountain Lore", "River Lore", "Swamp Lore"]
    }
};

const classes = {
    "": {
        saving_throws: {},
        skills: {},
        bonus_skills: 0,
        attacks: {},
        scores: [],
        hp: 0
    },
    "Druid": {
        saving_throws: {
            "Fortitude": Trained,
            "Reflex": Trained,
            "Will": Expert
        },
        skills: {
            "Nature": Trained
        },
        bonus_skills: 2,
        attacks: {
            "Simple Attacks": Trained,
            "Unarmed Attacks": Trained
        },
        scores: [
            "Wisdom"
        ],
        hp: 8
    }
};
</script>
<script type="text/babel">
function Accordion(props) {
    return (
        <div className={"accordion " + props.class} id={props.id}>
            {props.children}
        </div>
    );
}

function Collapse(props) {
    return (
        <div className="card">
            <div className="card-header" id={props.id + "-toggle"}>
                <h2 className="mb-0">
                <button className="btn btn-link collapsed" type="button" data-toggle="collapse" data-target={"#" + props.id} aria-expanded="false" aria-controls={props.id}>
                    {props.name}
                </button>
                </h2>
            </div>
            <div id={props.id} className="collapse" aria-labelledby={props.id + "-toggle"} data-parent={"#" + props.parent}>
                <div className="card-body">
                    {props.children}
                </div>
            </div>
        </div>
    );
}

class Application extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            notes: "",
            ancestry: "",
            ancestry_boost1: "",
            ancestry_boost2: "",
            background: "",
            background_boost1: "",
            background_boost2: "",
            class_: "",
            class_boost: "",
            boost1: "",
            boost2: "",
            boost3: "",
            boost4: "",
            equipment: "",
            alignment: "",
            deity: "",
            age: "",
            gender: ""
        };
        this.handleChange = this.handleChange.bind(this);
        this.bonuses = this.bonuses.bind(this);
        this.scores = this.scores.bind(this);
        this.ancestry = this.ancestry.bind(this);
        this.background = this.background.bind(this);
        this.class_ = this.class_.bind(this);
    }

    bonuses(step) {
        if (step === undefined) {
            step = 10;
        }
        const steps = [
            [],
            [],
            [this.ancestry().scores, this.state.ancestry_boost1, this.state.ancestry_boost2],
            [this.state.background_boost1, this.state.background_boost2],
            [this.state.class_boost],
            [this.state.boost1, this.state.boost2, this.state.boost3, this.state.boost4]
        ];
        let out = [];
        for (let i = 0; i < Math.min(steps.length, step); i++) {
            out = out.concat(steps[i]);
        }
        return out;
    }

    scores(step) {
        const bonuses = this.bonuses(step);
        const scores = {"": 0};
        stats.forEach((stat) => scores[stat] = 10);
        for (let data of bonuses) {
            if (typeof data === 'string') {
                scores[data] += 2;
            }
            else {
                for (let score of Object.keys(data)) {
                    scores[score] += data[score];
                }
            }
        }
        delete scores[""];
        return scores;
    }

    handleChange(event) {
        this.setState({[event.target.id]: event.target.value});
        if (event.target.id == "ancestry") {
            this.setState({
                ancestry_boost1: "",
                ancestry_boost2: ""
            })
        }
    }

    ancestry() {
        return ancestries[this.state.ancestry];
    }

    background() {
        return backgrounds[this.state.background];
    }

    class_() {
        return classes[this.state.class_];
    }

    render() {
        return (<form>
            <div className="alert alert-dark" role="alert">
                <h1 className="text-center">PF2 Character Builder</h1>
            </div>
            <Accordion id="steps">
                <Collapse parent="steps" id="step1" name="Step #1: Create a Concept">
                    <p>Start planning your character.</p>
                    <div className="form-group input-group">
                        <div className="input-group-prepend">
                            <label className="input-group-text" htmlFor="notes">Character Notes</label>
                        </div>
                        <textarea id="notes" className="form-control" rows="4" value={this.state.notes} onChange={this.handleChange}></textarea>
                    </div>
                </Collapse>

                <Collapse parent="steps" id="step2" name="Step #2: Start Building Ability Scores">
                    <p>Write down 10 for every ability score</p>
                    <ScoreBox scores={this.scores(2)} />
                </Collapse>

                <Collapse parent="steps" id="step3" name="Step #3: Select an Ancestry">
                    <p>Your character's ancestry determines their size, speed, languages, some of their hp, plus ability boosts and flaws.</p>
                    <div className="form-group input-group">
                        <div className="input-group-prepend">
                            <label className="input-group-text" htmlFor="ancestry">Ancestry</label>
                        </div>
                        <select id="ancestry" className="form-control custom-select" value={this.state.ancestry} onChange={this.handleChange}>
                            <option value="" key="">&darr;</option>
                            {Object.keys(ancestries).slice(1).map((item) => <option value={item} key={item}>{item}</option>)}
                        </select>
                    </div>
                    {(this.state.ancestry && this.ancestry().free >= 1) ?
                        <div className="form-group input-group">
                            <div className="input-group-prepend">
                                <label className="input-group-text" htmlFor="ancestry_boost1">Free Ability Boost</label>
                            </div>
                            <select id="ancestry_boost1" className="form-control custom-select" value={this.state.ancestry_boost1} onChange={this.handleChange}>
                                <option value="" key="">&darr;</option>
                                {stats.filter(
                                    (item) => !Object.keys(this.ancestry().scores).includes(item) && item != this.state.ancestry_boost2
                                ).map((item) => <option value={item} key={item}>{item}</option>)}
                            </select>
                        </div>
                    :""}
                    {(this.state.ancestry && this.ancestry().free >= 2) ?
                        <div className="form-group input-group">
                            <div className="input-group-prepend">
                                <label className="input-group-text" htmlFor="ancestry_boost2">Free Ability Boost</label>
                            </div>
                            <select id="ancestry_boost2" className="form-control custom-select" value={this.state.ancestry_boost2} onChange={this.handleChange}>
                                <option value="" key="">&darr;</option>
                                {stats.filter(
                                    (item) => !Object.keys(this.ancestry().scores).includes(item) && item != this.state.ancestry_boost1
                                ).map((item) => <option value={item} key={item}>{item}</option>)}
                            </select>
                        </div>
                    :""}
                    <ScoreBox scores={this.scores(3)} />
                </Collapse>

                <Collapse parent="steps" id="step4" name="Step #4: Pick a Background">
                    <p>Your character's background represents their upbringing, an aptitude they've been honing since their youth, or another aspect of their life before they became an adventuer.</p>
                    <div className="form-group input-group">
                        <div className="input-group-prepend">
                            <label className="input-group-text" htmlFor="background">Background</label>
                        </div>
                        <select id="background" className="form-control custom-select" value={this.state.background} onChange={this.handleChange}>
                            <option value="" key="">&darr;</option>
                            {Object.keys(backgrounds).slice(1).map((item) => <option value={item} key={item}>{item}</option>)}
                        </select>
                    </div>
                    {(this.state.background) ?
                        <div>
                            <div className="form-group input-group">
                                <div className="input-group-prepend">
                                    <label className="input-group-text" htmlFor="background_boost1">Background Ability Boost</label>
                                </div>
                                <select id="background_boost1" className="form-control custom-select" value={this.state.background_boost1} onChange={this.handleChange}>
                                    <option value="" key="">&darr;</option>
                                    {this.background().boost1.filter(
                                        (item) => item != this.state.background_boost2
                                    ).map((item) => <option value={item} key={item}>{item}</option>)}
                                </select>
                            </div>
                            <div className="form-group input-group">
                                <div className="input-group-prepend">
                                    <label className="input-group-text" htmlFor="background_boost2">Background Ability Boost</label>
                                </div>
                                <select id="background_boost2" className="form-control custom-select" value={this.state.background_boost2} onChange={this.handleChange}>
                                    <option value="" key="">&darr;</option>
                                    {this.background().boost2.filter(
                                        (item) => item != this.state.background_boost1
                                    ).map((item) => <option value={item} key={item}>{item}</option>)}
                                </select>
                            </div>
                        </div>
                    :""}
                    <ScoreBox scores={this.scores(4)} />
                </Collapse>

                <Collapse parent="steps" id="step5" name="Step #5: Choose a Class">
                    <p>A class gives your character access to a suite of heroic abilities, determines how effectively they fight, and governs how easily they can shake off or avoid certain harmful effects.</p>
                    <div className="form-group input-group">
                        <div className="input-group-prepend">
                            <label className="input-group-text" htmlFor="class_">Class</label>
                        </div>
                        <select id="class_" className="form-control custom-select" value={this.state.class_} onChange={this.handleChange}>
                            <option value="" key="">&darr;</option>
                            {Object.keys(classes).slice(1).map((item) => <option value={item} key={item}>{item}</option>)}
                        </select>
                    </div>
                    {(this.state.class_) ?
                        <div className="form-group input-group">
                            <div className="input-group-prepend">
                                <label className="input-group-text" htmlFor="class_boost">Class Ability Boost</label>
                            </div>
                            <select id="class_boost" className="form-control custom-select" value={this.state.class_boost} onChange={this.handleChange}>
                                <option value="" key="">&darr;</option>
                                {this.class_().scores.map((item) => <option value={item} key={item}>{item}</option>)}
                            </select>
                        </div>
                    :""}
                    <ScoreBox scores={this.scores(5)} />
                </Collapse>

                <Collapse parent="steps" id="step6" name="Step #6: Determine Ability Scores">
                    <p>Apply four free ability boosts to your scores, choosing a different ability score for each.</p>
                    <div className="form-group input-group">
                        <div className="input-group-prepend">
                            <label className="input-group-text" htmlFor="boost1">Ability Boost</label>
                        </div>
                        <select id="boost1" className="form-control custom-select" value={this.state.boost1} onChange={this.handleChange}>
                            <option value="" key="">&darr;</option>
                            {stats.filter(
                                (item) => ![this.state.boost2, this.state.boost3, this.state.boost4].includes(item)
                            ).map((item) => <option value={item} key={item}>{item}</option>)}
                        </select>
                    </div>
                    <div className="form-group input-group">
                        <div className="input-group-prepend">
                            <label className="input-group-text" htmlFor="boost2">Ability Boost</label>
                        </div>
                        <select id="boost2" className="form-control custom-select" value={this.state.boost2} onChange={this.handleChange}>
                            <option value="" key="">&darr;</option>
                            {stats.filter(
                                (item) => ![this.state.boost1, this.state.boost3, this.state.boost4].includes(item)
                            ).map((item) => <option value={item} key={item}>{item}</option>)}
                        </select>
                    </div>
                    <div className="form-group input-group">
                        <div className="input-group-prepend">
                            <label className="input-group-text" htmlFor="boost3">Ability Boost</label>
                        </div>
                        <select id="boost3" className="form-control custom-select" value={this.state.boost3} onChange={this.handleChange}>
                            <option value="" key="">&darr;</option>
                            {stats.filter(
                                (item) => ![this.state.boost1, this.state.boost2, this.state.boost4].includes(item)
                            ).map((item) => <option value={item} key={item}>{item}</option>)}
                        </select>
                    </div>
                    <div className="form-group input-group">
                        <div className="input-group-prepend">
                            <label className="input-group-text" htmlFor="boost4">Ability Boost</label>
                        </div>
                        <select id="boost4" className="form-control custom-select" value={this.state.boost4} onChange={this.handleChange}>
                            <option value="" key="">&darr;</option>
                            {stats.filter(
                                (item) => ![this.state.boost1, this.state.boost2, this.state.boost3].includes(item)
                            ).map((item) => <option value={item} key={item}>{item}</option>)}
                        </select>
                    </div>
                    <ScoreBox scores={this.scores(6)} />
                </Collapse>

                <Collapse parent="steps" id="step7" name="Step #7: Record Class Details">
                    <p>Now, record all the benefits and class features that your character receives from the class you've chosen.</p>
                    {(this.state.class_) ?
                        <ul className="container-fluid">
                            <li className="row border rounded-pill" key="class">
                                <div className="col-2">Class</div>
                                <div className="col">{this.state.class}</div>
                            </li>
                            <li className="row border rounded-pill" key="hp">
                                <div className="col-2">Hit Points (HP)</div>
                                <div className="col">{this.ancestry().hp + this.class_().hp + parseInt(this.scores().Constitution / 2 - 5)}</div>
                            </li>
                            <li className="row border rounded-pill" key="proficiencies">
                                <div className="col-2">Initial proficiencies</div>
                                <div className="col">{this.state.class}</div>
                            </li>
                            <li className="row border rounded-pill" key="features">
                                <div className="col-2">1st level features</div>
                                <div className="col">{this.state.class}</div>
                            </li>
                        </ul>
                    :""}
                </Collapse>

                <Collapse parent="steps" id="step8" name="Step #8: Buy Equipment">
                    <p>At 1st level your character has 15 gold pieces (150 silver pieces) to spend on armor, weapons, and other basic equipment.</p>
                    <div className="form-group input-group">
                        <div className="input-group-prepend">
                            <label className="input-group-text" htmlFor="equipment">Equipment</label>
                        </div>
                        <textarea id="equipment" className="form-control" rows="4" value={this.state.equipment} onChange={this.handleChange}></textarea>
                    </div>
                </Collapse>

                <Collapse parent="steps" id="step9" name="Step #9: Calculate Modifiers">
                    <p>Your modifiers are calculated here.</p>
                    <ul className="container-fluid">
                        <li className="row border rounded-pill" key="perception">
                            <div className="col-2">Perception</div>
                            <div className="col"></div>
                        </li>
                        <li className="row border rounded-pill" key="saving_throws">
                            <div className="col-2">Saving Throws</div>
                            <div className="col"></div>
                        </li>
                        <li className="row border rounded-pill" key="strikes">
                            <div className="col-2">Melee Strikes and Ranged Strikes</div>
                            <div className="col"></div>
                        </li>
                        <li className="row border rounded-pill" key="skills">
                            <div className="col-2">Skills</div>
                            <div className="col"></div>
                        </li>
                    </ul>
                </Collapse>

                <Collapse parent="steps" id="step10" name="Step #10: Finishing Details">
                    <p>Now add the following details to your character sheet in the apropriate spaces.</p>
                    <div className="form-group input-group">
                        <div className="input-group-prepend">
                            <label className="input-group-text" htmlFor="alignment">Alignment</label>
                        </div>
                        <select id="alignment" className="form-control custom-select" value={this.state.alignment} onChange={this.handleChange}>
                            <option value="" key="">&darr;</option>
                            <option value="Lawful Good" key="Lawful Good">Lawful Good</option>
                            <option value="Neutral Good" key="Neutral Good">Neutral Good</option>
                            <option value="Chaotic Good" key="Chaotic Good">Chaotic Good</option>
                            <option value="Lawful Neutral" key="Lawful Neutral">Lawful Neutral</option>
                            <option value="True Neutral" key="True Neutral">True Neutral</option>
                            <option value="Chaotic Neutral" key="Chaotic Neutral">Chaotic Neutral</option>
                            <option value="Lawful Evil" key="Lawful Evil">Lawful Evil</option>
                            <option value="Neutral Evil" key="Neutral Evil">Neutral Evil</option>
                            <option value="Chaotic Evil" key="Chaotic Evil">Chaotic Evil</option>
                        </select>
                    </div>
                    <div className="form-group input-group">
                        <div className="input-group-prepend">
                            <label className="input-group-text" htmlFor="deity">Deity</label>
                        </div>
                        <input type="text" id="deity" className="form-control" value={this.state.deity} onChange={this.handleChange} />
                    </div>
                    <div className="form-group input-group">
                        <div className="input-group-prepend">
                            <label className="input-group-text" htmlFor="age">Age</label>
                        </div>
                        <input type="number" id="age" className="form-control" value={this.state.age} onChange={this.handleChange} />
                    </div>
                    <div className="form-group input-group">
                        <div className="input-group-prepend">
                            <label className="input-group-text" htmlFor="gender">Gender and Pronouns</label>
                        </div>
                        <input type="text" id="gender" className="form-control" value={this.state.gender} onChange={this.handleChange} />
                    </div>
                    <p>Class DC</p>
                    <p>Hero Points</p>
                    <p>Armor Class (AC)</p>
                    <p>Bulk</p>
                </Collapse>
            </Accordion>
        </form>);
    }
}

function ScoreBox(props) {
    return (
        <ul className="container-fluid">
            {Object.entries(props.scores).map((item) =>
                (<li className="row border rounded-pill" key={item[0]}>
                    <div className="col-1">{item[1]}</div>
                    <div className="col">{item[0]}</div>
                </li>))}
        </ul>
    );
}

ReactDOM.render(
    <Application />,
    document.getElementById("app")
)
</script>
</body>
</html>
